<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell, PatternGuards, MagicHash #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | This module provides a quotation feature to let you write command line</span><span>
</span><span id="line-4"></span><span class="hs-comment">--   arguments in the impure style, but have them translated into the pure style,</span><span>
</span><span id="line-5"></span><span class="hs-comment">--   as per &quot;System.Console.CmdArgs.Implicit&quot;. An example:</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- &gt; {-# LANGUAGE TemplateHaskell, DeriveDataTypeable, MagicHash #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- &gt; import System.Console.CmdArgs.Implicit</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- &gt; import System.Console.CmdArgs.Quote</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- &gt; data Sample = Sample {hello :: String} deriving (Show, Data, Typeable)</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- &gt; $(cmdArgsQuote [d|</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- &gt;     sample = Sample{hello = def &amp;=# help &quot;World argument&quot; &amp;=# opt &quot;world&quot;}</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- &gt;                    &amp;=# summary &quot;Sample v1&quot;</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- &gt;     run = cmdArgs# sample :: IO Sample</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &gt;     |])</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- &gt; main = print =&lt;&lt; run</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">--   Inside 'cmdArgsQuote' you supply the command line parser using attributes in the</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   impure style. If you run with @-ddump-splices@ (to see the Template Haskell output),</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   you would see:</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- &gt; run = cmdArgs_</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- &gt;     (record Sample{} [hello := def += help &quot;World argument&quot; += opt &quot;world&quot;]</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- &gt;         += summary &quot;Sample v1&quot;)</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- &gt;     :: IO Sample</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   /Stubs/</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   To define the original parser you may use either the standard impure annotations ('(&amp;=)', 'modes'), or</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   the stub annotations versions defined in this module ('(&amp;=#)', 'modes'). The stub versions do not include</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   a &quot;Data&quot; constraint, so can be used in situations where the Data instance is not yet available - typically</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   when defining the parser in the same module as the data type on GHC 7.2 and above. The stub versions should</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   never be used outside 'cmdArgsQuote' and will always raise an error.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   /Explicit types/</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">--   There will be a limited number of situations where an impure parser will require additional types, typically</span><span>
</span><span id="line-42"></span><span class="hs-comment">--   on the result of 'cmdArgs' if the result is used without a fixed type - for example if you 'show' it. Most users</span><span>
</span><span id="line-43"></span><span class="hs-comment">--   will not need to add any types. In some cases you may need to remove some explicit types, where the intermediate</span><span>
</span><span id="line-44"></span><span class="hs-comment">--   type of the annotations has changed - but again, this change should be rare.</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">--   /Completeness/</span><span>
</span><span id="line-47"></span><span class="hs-comment">--</span><span>
</span><span id="line-48"></span><span class="hs-comment">--   The translation is not complete, although works for all practical instances I've tried. The translation works</span><span>
</span><span id="line-49"></span><span class="hs-comment">--   by first expanding out the expression (inlining every function defined within the quote, inlining let bindings),</span><span>
</span><span id="line-50"></span><span class="hs-comment">--   then performs the translation. This scheme leads to two consequences: 1) Any expensive computation executed inside</span><span>
</span><span id="line-51"></span><span class="hs-comment">--   the quotation to produce the command line flags may be duplicated (a very unlikely scenario). 2) As I do not yet</span><span>
</span><span id="line-52"></span><span class="hs-comment">--   have expansion rules for all possible expressions, the expansion (and subsequently the translation) may fail.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--   I am interested in any bug reports where the feature does not work as intended.</span><span>
</span><span id="line-54"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Console.CmdArgs.Quote</span><span class="hs-special">(</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Template Haskell quotation function</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgsQuote"><span class="hs-identifier">cmdArgsQuote</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Stub versions of the impure annotations</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#%26%3D%23"><span class="hs-operator">(&amp;=#)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#modes%23"><span class="hs-identifier">modes#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgsMode%23"><span class="hs-identifier">cmdArgsMode#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgs%23"><span class="hs-identifier">cmdArgs#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#enum%23"><span class="hs-identifier">enum#</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Implicit.html"><span class="hs-identifier">System.Console.CmdArgs.Implicit</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span id="stub"><span class="annot"><span class="annottext">stub :: [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var hs-var">stub</span></a></span></span><span> </span><span id="local-6989586621679281546"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679281546"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; a) -&gt; [Char] -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;System.Console.CmdArgs.Quote.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679281546"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: this function is provided only for use inside cmdArgsQuote, and should never be called&quot;</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- | Version of '&amp;=' without a 'Data' context, only to be used within 'cmdArgsQuote'.</span></span><span>
</span><span id="line-73"></span><span id="local-6989586621679281431"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#%26%3D%23"><span class="hs-operator hs-type">(&amp;=#)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679281431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Implicit.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281431"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-74"></span><span id="%26%3D%23"><span class="annot"><span class="annottext">&amp;=# :: forall a. a -&gt; Ann -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#%26%3D%23"><span class="hs-operator hs-var hs-var">(&amp;=#)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; a -&gt; Ann -&gt; a
forall {a}. [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var">stub</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;(&amp;=#)&quot;</span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><span class="hs-comment">-- | Version of 'modes' without a 'Data' context, only to be used within 'cmdArgsQuote'.</span></span><span>
</span><span id="line-77"></span><span id="local-6989586621679281434"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#modes%23"><span class="hs-identifier hs-type">modes#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679281434"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281434"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-78"></span><span id="modes%23"><span class="annot"><span class="annottext">modes# :: forall a. [a] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#modes%23"><span class="hs-identifier hs-var hs-var">modes#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [a] -&gt; a
forall {a}. [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var">stub</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;modes#&quot;</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- | Version of 'cmdArgsMode' without a 'Data' context, only to be used within 'cmdArgsQuote'.</span></span><span>
</span><span id="line-81"></span><span id="local-6989586621679281436"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgsMode%23"><span class="hs-identifier hs-type">cmdArgsMode#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679281436"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.CmdArgs.Explicit.Type.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.CmdArgs.Implicit.Type.html#CmdArgs"><span class="hs-identifier hs-type">CmdArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679281436"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-82"></span><span id="cmdArgsMode%23"><span class="annot"><span class="annottext">cmdArgsMode# :: forall a. a -&gt; Mode (CmdArgs a)
</span><a href="System.Console.CmdArgs.Quote.html#cmdArgsMode%23"><span class="hs-identifier hs-var hs-var">cmdArgsMode#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; a -&gt; Mode (CmdArgs a)
forall {a}. [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var">stub</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cmdArgsMode#&quot;</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><span class="hs-comment">-- | Version of 'cmdArgs' without a 'Data' context, only to be used within 'cmdArgsQuote'.</span></span><span>
</span><span id="line-85"></span><span id="local-6989586621679281440"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgs%23"><span class="hs-identifier hs-type">cmdArgs#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679281440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679281440"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-86"></span><span id="cmdArgs%23"><span class="annot"><span class="annottext">cmdArgs# :: forall a. a -&gt; IO a
</span><a href="System.Console.CmdArgs.Quote.html#cmdArgs%23"><span class="hs-identifier hs-var hs-var">cmdArgs#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; a -&gt; IO a
forall {a}. [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var">stub</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cmdArgs#&quot;</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | Version of 'enum' without a 'Data' context, only to be used within 'cmdArgsQuote'.</span></span><span>
</span><span id="line-89"></span><span id="local-6989586621679281550"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#enum%23"><span class="hs-identifier hs-type">enum#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679281550"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281550"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-90"></span><span id="enum%23"><span class="annot"><span class="annottext">enum# :: forall a. [a] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#enum%23"><span class="hs-identifier hs-var hs-var">enum#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [a] -&gt; a
forall {a}. [Char] -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#stub"><span class="hs-identifier hs-var">stub</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;enum#&quot;</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Quotation function to turn an impure version of &quot;System.Console.CmdArgs.Implicit&quot; into a pure one.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--   For details see &quot;System.Console.CmdArgs.Quote&quot;.</span><span>
</span><span id="line-95"></span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#cmdArgsQuote"><span class="hs-identifier hs-type">cmdArgsQuote</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span id="cmdArgsQuote"><span class="annot"><span class="annottext">cmdArgsQuote :: Q [Dec] -&gt; Q [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#cmdArgsQuote"><span class="hs-identifier hs-var hs-var">cmdArgsQuote</span></a></span></span><span> </span><span id="local-6989586621679281551"><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679281551"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679281552"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281552"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679281551"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">[Dec] -&gt; Q [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#translate"><span class="hs-identifier hs-var">translate</span></a></span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; Q [Dec]) -&gt; [Dec] -&gt; Q [Dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; [Dec]) -&gt; [Dec] -&gt; [Dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; [Dec]) -&gt; [Dec] -&gt; [Dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#inline"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281552"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- | Apply the rewrite rules</span></span><span>
</span><span id="line-102"></span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#translate"><span class="hs-identifier hs-type">translate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span id="translate"><span class="annot"><span class="annottext">translate :: [Dec] -&gt; Q [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#translate"><span class="hs-identifier hs-var hs-var">translate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Q Exp) -&gt; [Dec] -&gt; Q [Dec]
forall a b (m :: * -&gt; *).
(Data a, Data b, Monad m) =&gt;
(b -&gt; m b) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendBiM"><span class="hs-identifier hs-var">descendBiM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Q Exp
forall {m :: * -&gt; *}. Quote m =&gt; Exp -&gt; m Exp
</span><a href="#local-6989586621679281558"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>        </span><span id="local-6989586621679281559"><span class="annot"><span class="annottext">dull :: [Name]
</span><a href="#local-6989586621679281559"><span class="hs-identifier hs-var hs-var">dull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-identifier">Just</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Left</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Right</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Prelude constructors of non-zero arity</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>        </span><span id="local-6989586621679281558"><span class="annot"><span class="annottext">f :: Exp -&gt; m Exp
</span><a href="#local-6989586621679281558"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecConE</span></span><span> </span><span id="local-6989586621679281593"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281593"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679281594"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281594"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; m Exp
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; m Exp) -&gt; Exp -&gt; m Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-108"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679281595"><span class="annot"><span class="annottext">args :: [Exp]
</span><a href="#local-6989586621679281595"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281596"><span class="hs-identifier hs-var">anns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe Exp) -&gt; Exp -&gt; Maybe Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281599"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">:=</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281601"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281602"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281599"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281599"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281603"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281603"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281594"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281601"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281601"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679281602"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281602"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281603"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">record</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [FieldExp] -&gt; Exp
</span><span class="hs-identifier hs-var">RecConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281593"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281595"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><a href="#local-6989586621679281558"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679281607"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281607"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConE</span></span><span> </span><span id="local-6989586621679281608"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281608"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679281609"><span class="annot"><span class="annottext">xs :: [Exp]
</span><a href="#local-6989586621679281609"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Exp]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281610"><span class="hs-identifier hs-var">asApps</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281607"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281608"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281559"><span class="hs-identifier hs-var">dull</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>            </span><span id="local-6989586621679281612"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281612"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; m Name) -&gt; m [Name]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">[Exp] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281609"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m Name) -&gt; m [Name]) -&gt; (Int -&gt; m Name) -&gt; m [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679281615"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679281615"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m Name
forall (m :: * -&gt; *). Quote m =&gt; [Char] -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m Name) -&gt; [Char] -&gt; m Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281608"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679281615"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281617"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281617"><span class="hs-identifier hs-var">vals</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679281618"><span class="annot"><span class="annottext">[[Exp]]
</span><a href="#local-6989586621679281618"><span class="hs-identifier hs-var">ass</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Exp, [Exp])] -&gt; ([Exp], [[Exp]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Exp, [Exp])] -&gt; ([Exp], [[Exp]]))
-&gt; [(Exp, [Exp])] -&gt; ([Exp], [[Exp]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; (Exp, [Exp])) -&gt; [Exp] -&gt; [(Exp, [Exp])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281609"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-114"></span><span>                </span><span id="local-6989586621679281620"><span class="annot"><span class="annottext">bind :: [Dec]
</span><a href="#local-6989586621679281620"><span class="hs-identifier hs-var hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">ValD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281623"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281625"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281623"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281623"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281625"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281625"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Exp] -&gt; [FieldExp]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281612"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281617"><span class="hs-identifier hs-var">vals</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>                </span><span id="local-6989586621679281626"><span class="annot"><span class="annottext">args :: [Exp]
</span><a href="#local-6989586621679281626"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281596"><span class="hs-identifier hs-var">anns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">atom</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281627"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281628"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281627"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281627"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281628"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281628"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [[Exp]] -&gt; [(Name, [Exp])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281612"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">[[Exp]]
</span><a href="#local-6989586621679281618"><span class="hs-identifier hs-var">ass</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>            </span><span class="annot"><span class="annottext">Exp -&gt; m Exp
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; m Exp) -&gt; Exp -&gt; m Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LetE</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281620"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">record</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281608"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281630"><span class="hs-operator hs-var">`apps`</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Exp) -&gt; [Name] -&gt; [Exp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281612"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281626"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="#local-6989586621679281558"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679281631"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281631"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; m Exp) -&gt; Exp -&gt; m Exp
forall a (m :: * -&gt; *). (Data a, Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendM"><span class="hs-identifier hs-var">descendM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; m Exp
</span><a href="#local-6989586621679281558"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281631"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679281630"><span class="annot"><span class="annottext">apps :: Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281630"><span class="hs-identifier hs-var hs-var">apps</span></a></span></span><span> </span><span id="local-6989586621679281633"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281633"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281633"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><a href="#local-6989586621679281630"><span class="hs-identifier hs-var">apps</span></a></span><span> </span><span id="local-6989586621679281634"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281634"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281635"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281635"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679281636"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281636"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281630"><span class="hs-identifier hs-var">apps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281634"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281635"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281636"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>        </span><span id="local-6989586621679281610"><span class="annot"><span class="annottext">asApps :: Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281610"><span class="hs-identifier hs-var hs-var">asApps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppE</span></span><span> </span><span id="local-6989586621679281637"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281637"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679281638"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281638"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281639"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281639"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281640"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281640"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281610"><span class="hs-identifier hs-var">asApps</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281637"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281639"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281640"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">[Exp] -&gt; [Exp] -&gt; [Exp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281638"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="#local-6989586621679281610"><span class="hs-identifier hs-var">asApps</span></a></span><span> </span><span id="local-6989586621679281641"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281641"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281641"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621679281596"><span class="annot"><span class="annottext">anns :: Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281596"><span class="hs-identifier hs-var hs-var">anns</span></a></span></span><span> </span><span id="local-6989586621679281642"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281642"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281642"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><a href="#local-6989586621679281596"><span class="hs-identifier hs-var">anns</span></a></span><span> </span><span id="local-6989586621679281643"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281643"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281644"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281644"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679281645"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281645"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="#local-6989586621679281596"><span class="hs-identifier hs-var">anns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281643"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">+=</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281644"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281645"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>        </span><span id="local-6989586621679281604"><span class="annot"><span class="annottext">asAnns :: Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281604"><span class="hs-identifier hs-var hs-var">asAnns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281648"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281648"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarE</span></span><span> </span><span id="local-6989586621679281649"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281649"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281650"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281650"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281649"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">+=</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281651"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281651"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281652"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281652"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281648"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281651"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281652"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">[Exp] -&gt; [Exp] -&gt; [Exp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281650"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarE</span></span><span> </span><span id="local-6989586621679281653"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281653"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679281654"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281654"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679281655"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281655"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281653"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">+=</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281656"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281656"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281657"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281657"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; (Exp, [Exp])
</span><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281654"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281656"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679281657"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">[Exp] -&gt; [Exp] -&gt; [Exp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281655"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><a href="#local-6989586621679281604"><span class="hs-identifier hs-var">asAnns</span></a></span><span> </span><span id="local-6989586621679281658"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281658"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281658"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><span class="hs-comment">-- | Move from the old names to the new names, sufficient for where that is the full translation</span></span><span>
</span><span id="line-135"></span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#rename"><span class="hs-identifier hs-type">rename</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span id="rename"><span class="annot"><span class="annottext">rename :: [Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#rename"><span class="hs-identifier hs-var hs-var">rename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; [Dec] -&gt; [Dec]
forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transformBi"><span class="hs-identifier hs-var">transformBi</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679281660"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>        </span><span id="local-6989586621679281662"><span class="annot"><span class="annottext">rep :: [(Name, Name)]
</span><a href="#local-6989586621679281662"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679281663"><span class="annot"><span class="annottext">f :: a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679281664"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281664"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679281665"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281665"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679281666"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679281666"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281664"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679281666"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281665"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679281666"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[[(Name, Name)]] -&gt; [(Name, Name)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; [(Name, Name)]
forall {a} {b}. a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&amp;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&amp;=#</span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">+=</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; [(Name, Name)]
forall {a} {b}. a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">modes</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">modes#</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">modes_</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; [(Name, Name)]
forall {a} {b}. a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">enum</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">enum#</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">enum_</span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; [(Name, Name)]
forall {a} {b}. a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgsMode</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgsMode#</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgsMode_</span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name -&gt; [(Name, Name)]
forall {a} {b}. a -&gt; a -&gt; b -&gt; [(a, b)]
</span><a href="#local-6989586621679281663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgs</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgs#</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">cmdArgs_</span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621679281660"><span class="annot"><span class="annottext">f :: Exp -&gt; Exp
</span><a href="#local-6989586621679281660"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarE</span></span><span> </span><span id="local-6989586621679281669"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281669"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281670"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281670"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Name, Name)] -&gt; Maybe Name
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281669"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Name)]
</span><a href="#local-6989586621679281662"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281670"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><a href="#local-6989586621679281660"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679281672"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281672"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281672"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Simplify the syntax tree - things like application of a lambda</span></span><span>
</span><span id="line-150"></span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#simplify"><span class="hs-identifier hs-type">simplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-151"></span><span id="simplify"><span class="annot"><span class="annottext">simplify :: [Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#simplify"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; [Dec] -&gt; [Dec]
forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transformBi"><span class="hs-identifier hs-var">transformBi</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679281673"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>        </span><span id="local-6989586621679281673"><span class="annot"><span class="annottext">f :: Exp -&gt; Exp
</span><a href="#local-6989586621679281673"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LamE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VarP</span></span><span> </span><span id="local-6989586621679281675"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281675"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621679281676"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281676"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679281677"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281677"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679281673"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281678"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281675"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281677"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281676"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><a href="#local-6989586621679281673"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679281679"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281679"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281679"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>        </span><span id="local-6989586621679281678"><span class="annot"><span class="annottext">subst :: Name -&gt; Exp -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281678"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679281681"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281681"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679281682"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281682"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679281683"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281683"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679281685"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281683"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679281685"><span class="annot"><span class="annottext">f :: Exp -&gt; Exp
</span><a href="#local-6989586621679281685"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarE</span></span><span> </span><span id="local-6989586621679281687"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281687"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281681"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281687"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281682"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-158"></span><span>                  </span><span class="annot"><a href="#local-6989586621679281685"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679281688"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281688"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281688"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-comment">-- | Evaluate through all locally defined functions and let expressions, at most once per defn</span></span><span>
</span><span id="line-162"></span><span class="annot"><a href="System.Console.CmdArgs.Quote.html#inline"><span class="hs-identifier hs-type">inline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span id="inline"><span class="annot"><span class="annottext">inline :: [Dec] -&gt; [Dec]
</span><a href="System.Console.CmdArgs.Quote.html#inline"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span id="local-6989586621679281689"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281689"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Dec) -&gt; [Dec] -&gt; [Dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp] -&gt; Dec -&gt; Dec
</span><a href="#local-6989586621679281690"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldExp] -&gt; Dec -&gt; Dec) -&gt; [FieldExp] -&gt; Dec -&gt; Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281691"><span class="hs-identifier hs-var">addEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281689"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281689"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>        </span><span id="local-6989586621679281693"><span class="annot"><span class="annottext">newEnv :: [Dec] -&gt; [FieldExp]
</span><a href="#local-6989586621679281693"><span class="hs-identifier hs-var hs-var">newEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; [FieldExp]) -&gt; [Dec] -&gt; [FieldExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">((Dec -&gt; [FieldExp]) -&gt; [Dec] -&gt; [FieldExp])
-&gt; (Dec -&gt; [FieldExp]) -&gt; [Dec] -&gt; [FieldExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679281695"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679281695"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679281695"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">FunD</span></span><span> </span><span id="local-6989586621679281697"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281697"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span> </span><span id="local-6989586621679281699"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679281699"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NormalB</span></span><span> </span><span id="local-6989586621679281700"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281700"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679281701"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281701"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281697"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679281699"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281702"><span class="hs-identifier hs-var">let_</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281701"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281700"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">ValD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarP</span></span><span> </span><span id="local-6989586621679281703"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281703"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NormalB</span></span><span> </span><span id="local-6989586621679281704"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281704"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679281705"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281705"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281703"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281702"><span class="hs-identifier hs-var">let_</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281705"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281704"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>            </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679281691"><span class="annot"><span class="annottext">addEnv :: [Dec] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281691"><span class="hs-identifier hs-var hs-var">addEnv</span></a></span></span><span> </span><span id="local-6989586621679281708"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281708"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679281709"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281709"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281710"><span class="hs-identifier hs-var">without</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; [FieldExp]
</span><a href="#local-6989586621679281693"><span class="hs-identifier hs-var">newEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281708"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; [FieldExp] -&gt; [FieldExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281709"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-171"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>                </span><span class="hs-comment">-- create an environment where everything in ns is missing, recursively drop one thing each time</span><span>
</span><span id="line-173"></span><span>                </span><span id="local-6989586621679281710"><span class="annot"><span class="annottext">without :: [Name] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281710"><span class="hs-identifier hs-var hs-var">without</span></a></span></span><span> </span><span id="local-6989586621679281713"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281713"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679281714"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281714"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281715"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281717"><span class="hs-identifier hs-var">new2</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; [FieldExp] -&gt; [FieldExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281709"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281718"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679281715"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281715"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679281718"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281718"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281714"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281715"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281713"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679281717"><span class="annot"><span class="annottext">new2 :: [FieldExp]
</span><a href="#local-6989586621679281717"><span class="hs-identifier hs-var hs-var">new2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281710"><span class="hs-identifier hs-var">without</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281715"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; [Name]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679281713"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281714"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679281690"><span class="annot"><span class="annottext">dec :: [FieldExp] -&gt; Dec -&gt; Dec
</span><a href="#local-6989586621679281690"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621679281719"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281719"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FunD</span></span><span> </span><span id="local-6989586621679281720"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281720"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679281721"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679281721"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281720"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([Clause] -&gt; Dec) -&gt; [Clause] -&gt; Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; Clause) -&gt; [Clause] -&gt; [Clause]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp] -&gt; Clause -&gt; Clause
</span><a href="#local-6989586621679281722"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281719"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679281721"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><a href="#local-6989586621679281690"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span id="local-6989586621679281723"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281723"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ValD</span></span><span> </span><span id="local-6989586621679281724"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679281724"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679281725"><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679281725"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679281726"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281726"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">ValD</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679281724"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp] -&gt; Body -&gt; Body
</span><a href="#local-6989586621679281727"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281691"><span class="hs-identifier hs-var">addEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281726"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281723"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679281725"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281726"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>        </span><span id="local-6989586621679281722"><span class="annot"><span class="annottext">clause :: [FieldExp] -&gt; Clause -&gt; Clause
</span><a href="#local-6989586621679281722"><span class="hs-identifier hs-var hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679281728"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281728"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span> </span><span id="local-6989586621679281729"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679281729"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679281730"><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679281730"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679281731"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281731"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679281729"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp] -&gt; Body -&gt; Body
</span><a href="#local-6989586621679281727"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281691"><span class="hs-identifier hs-var">addEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281731"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281728"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679281730"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281731"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>        </span><span id="local-6989586621679281727"><span class="annot"><span class="annottext">body :: [FieldExp] -&gt; Body -&gt; Body
</span><a href="#local-6989586621679281727"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679281734"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281734"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GuardedB</span></span><span> </span><span id="local-6989586621679281736"><span class="annot"><span class="annottext">[(Guard, Exp)]
</span><a href="#local-6989586621679281736"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Guard, Exp)] -&gt; Body
</span><span class="hs-identifier hs-var">GuardedB</span></span><span> </span><span class="annot"><span class="annottext">([(Guard, Exp)] -&gt; Body) -&gt; [(Guard, Exp)] -&gt; Body
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Guard, Exp) -&gt; (Guard, Exp)) -&gt; [(Guard, Exp)] -&gt; [(Guard, Exp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; (Guard, Exp) -&gt; (Guard, Exp)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Exp) -&gt; (Guard, Exp) -&gt; (Guard, Exp))
-&gt; (Exp -&gt; Exp) -&gt; (Guard, Exp) -&gt; (Guard, Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281734"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Guard, Exp)]
</span><a href="#local-6989586621679281736"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><a href="#local-6989586621679281727"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span id="local-6989586621679281738"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281738"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NormalB</span></span><span> </span><span id="local-6989586621679281739"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281739"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Body) -&gt; Exp -&gt; Body
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281738"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281739"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- FIXME: propagating the env ignores variables shadowed by LamE/CaseE</span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621679281716"><span class="annot"><span class="annottext">exp :: [FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621679281740"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281740"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LetE</span></span><span> </span><span id="local-6989586621679281741"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281741"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679281742"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281742"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LetE</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281741"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; [FieldExp] -&gt; [FieldExp]
</span><a href="#local-6989586621679281691"><span class="hs-identifier hs-var">addEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281741"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281740"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281742"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span id="local-6989586621679281743"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281743"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarE</span></span><span> </span><span id="local-6989586621679281744"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281744"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281745"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281745"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [FieldExp] -&gt; Maybe Exp
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679281744"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281743"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281745"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span id="local-6989586621679281746"><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281746"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679281747"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281747"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descend"><span class="hs-identifier hs-var">descend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldExp] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281716"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldExp]
</span><a href="#local-6989586621679281746"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281747"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>        </span><span id="local-6989586621679281702"><span class="annot"><span class="annottext">let_ :: [Dec] -&gt; Exp -&gt; Exp
</span><a href="#local-6989586621679281702"><span class="hs-identifier hs-var hs-var">let_</span></a></span></span><span> </span><span id="local-6989586621679281750"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281750"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679281751"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281751"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281750"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281751"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LetE</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679281750"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679281751"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- MINI UNIPLATE - Avoid the dependency just for one small module</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span id="local-6989586621679281753"><span id="local-6989586621679281754"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#descendBi"><span class="hs-identifier hs-type">descendBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281753"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281754"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281754"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281754"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281753"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281753"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-196"></span><span id="descendBi"><span class="annot"><span class="annottext">descendBi :: forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descendBi"><span class="hs-identifier hs-var hs-var">descendBi</span></a></span></span><span> </span><span id="local-6989586621679281766"><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621679281766"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679281767"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281767"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281768"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281768"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Maybe (a -&gt; a)
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621679281766"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281768"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281767"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-197"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
forall a. Data a =&gt; (forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">gmapT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; b -&gt; b
forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descendBi"><span class="hs-identifier hs-var">descendBi</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621679281766"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281767"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span id="local-6989586621679281774"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#descend"><span class="hs-identifier hs-type">descend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281774"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281774"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281774"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281774"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281774"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-200"></span><span id="descend"><span class="annot"><span class="annottext">descend :: forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descend"><span class="hs-identifier hs-var hs-var">descend</span></a></span></span><span> </span><span id="local-6989586621679281777"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281777"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
forall a. Data a =&gt; (forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">gmapT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; b -&gt; b
forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descendBi"><span class="hs-identifier hs-var">descendBi</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281777"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621679281479"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#transform"><span class="hs-identifier hs-type">transform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281479"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281479"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-203"></span><span id="transform"><span class="annot"><span class="annottext">transform :: forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transform"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621679281784"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281784"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281784"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descend"><span class="hs-identifier hs-var">descend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679281784"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621679281471"><span id="local-6989586621679281472"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#transformBi"><span class="hs-identifier hs-type">transformBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281472"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281471"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281471"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-206"></span><span id="transformBi"><span class="annot"><span class="annottext">transformBi :: forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transformBi"><span class="hs-identifier hs-var hs-var">transformBi</span></a></span></span><span> </span><span id="local-6989586621679281791"><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621679281791"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; a -&gt; a
forall a b. (Data a, Data b) =&gt; (b -&gt; b) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#descendBi"><span class="hs-identifier hs-var">descendBi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; b -&gt; b
forall a. Data a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="System.Console.CmdArgs.Quote.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621679281791"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span id="local-6989586621679281443"><span id="local-6989586621679281444"><span id="local-6989586621679281445"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#descendBiM"><span class="hs-identifier hs-type">descendBiM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281443"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679281445"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281444"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281445"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679281444"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281445"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679281443"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-209"></span><span id="descendBiM"><span class="annot"><span class="annottext">descendBiM :: forall a b (m :: * -&gt; *).
(Data a, Data b, Monad m) =&gt;
(b -&gt; m b) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendBiM"><span class="hs-identifier hs-var hs-var">descendBiM</span></a></span></span><span> </span><span id="local-6989586621679281806"><span class="annot"><span class="annottext">b -&gt; m b
</span><a href="#local-6989586621679281806"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679281807"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281807"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281808"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679281808"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281807"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a) -&gt; m b -&gt; m a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; a
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; a) -&gt; (b -&gt; Maybe a) -&gt; b -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Maybe a
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m b -&gt; m a) -&gt; m b -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
</span><a href="#local-6989586621679281806"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679281808"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-comment">-- guaranteed safe</span><span>
</span><span id="line-210"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
forall a (m :: * -&gt; *).
(Data a, Monad m) =&gt;
(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">gmapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; m b) -&gt; d -&gt; m d
forall a b (m :: * -&gt; *).
(Data a, Data b, Monad m) =&gt;
(b -&gt; m b) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendBiM"><span class="hs-identifier hs-var">descendBiM</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
</span><a href="#local-6989586621679281806"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679281807"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span id="local-6989586621679281468"><span id="local-6989586621679281469"><span class="annot"><a href="System.Console.CmdArgs.Quote.html#descendM"><span class="hs-identifier hs-type">descendM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679281468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679281469"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679281468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281469"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679281468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679281469"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679281468"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-213"></span><span id="descendM"><span class="annot"><span class="annottext">descendM :: forall a (m :: * -&gt; *). (Data a, Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendM"><span class="hs-identifier hs-var hs-var">descendM</span></a></span></span><span> </span><span id="local-6989586621679281820"><span class="annot"><span class="annottext">a -&gt; m a
</span><a href="#local-6989586621679281820"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
forall a (m :: * -&gt; *).
(Data a, Monad m) =&gt;
(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">gmapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; d -&gt; m d
forall a b (m :: * -&gt; *).
(Data a, Data b, Monad m) =&gt;
(b -&gt; m b) -&gt; a -&gt; m a
</span><a href="System.Console.CmdArgs.Quote.html#descendBiM"><span class="hs-identifier hs-var">descendBiM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
</span><a href="#local-6989586621679281820"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span></pre></body></html>